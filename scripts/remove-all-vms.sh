#!/bin/bash
#
# version: 20161112.001

###############################################################################
#                global vars
###############################################################################


###############################################################################
#                functions
###############################################################################

remove_all_vms() {
  for VM in $(virsh list --all | grep -v Id | grep -v "^-" | awk '{ print $2 }')
  do 
    virsh destroy ${VM}
    virsh undefine --remove-all-storage --snapshots-metadata --wipe-storage ${VM}
  done
}

main() {
  echo
  echo "----------------------------------------------------------------------"
  echo "Removing all Libvirt VMs ..."
  echo
  remove_all_vms
}


###############################################################################
#                main code body
###############################################################################

main
